<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tastiera Virtuale</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        body {
            background: rgba(255, 255, 255, 0.8);
            margin: 0;
            padding: 0;
        }

        #page-content {
            position: relative;
            z-index: 1;
            padding-bottom: 100px;
            margin: 30px;
        }

        #keyboard-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: rgba(248, 249, 250, 0.9);
            border-bottom: 1px solid #ced4da;
            z-index: 10000;
            padding: 10px;
            box-shadow: 0px 5px 10px 0px #888888;
            margin: 30px;
            font-size: 20px;
            border-radius: 15px;
        }

        .keyboard-layout {
            display: none;
        }

        .keyboard-row {
            display: flex;
            justify-content: center;
            padding: 5px;
        }

        .keyboard-key {
            width: 80px;
            height: 80px;
            margin: 2px;
            text-align: center;
            line-height: 80px;
            cursor: pointer;
            border: 1.5px solid lightgray;
            border-radius: 10px;
            display: inline-block;
            font-size: 25px;
        }

        .uppercase-toggle,
        .capslock-toggle,
        .shift-toggle {
            background-color: #007bff;
            color: #fff;
        }

        #btnClose {
            background-color: #ff0000;
            margin-bottom: 5px;
            border-radius: 10px;
        }

        .keyboard-key[data-key=" "] {
            width: 50%;
        }

        .keyboard-key[data-key="layout"],
        .keyboard-key[data-key="delete"],
        .keyboard-key[data-key="tab"],
        .keyboard-key[data-key="enter"],
        .keyboard-key[data-key="shift"],
        .keyboard-key[data-key="capslock"] {
            width: 200px;
        }

        .keyboard-key[data-key="↑"],
        .keyboard-key[data-key="↓"] {
            height: 39px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 2px;
        }

        .keyboard-key[data-key="←"],
        .keyboard-key[data-key="→"] {
            height: 39px;
            margin-top: 43px;
            text-align: center;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .capslock-toggle {
            background-color: rgba(248, 249, 250, 0.9);
            color: black;
        }

        .shift-toggle {
            background-color: rgba(248, 249, 250, 0.9);
            color: black;
        }

        .capslock-toggle.active {
            background-color: #007bff;
            color: #fff;
        }

        .shift-toggle.active {
            background-color: #007bff;
            color: #fff;
        }

        #keyboard-input {
            outline: none !important;
            border-color: #007bff;
            box-shadow: 0 0 10px #007bff;
            position: relative;
        }

        #keyboard-input::after {
            content: "|";
            position: absolute;
            animation: blink-caret 1s infinite;
        }

        .symbol-toggle.active{
            background-color: #007bff;
            color: #fff;
        }

        @keyframes blink-caret {
            50% {
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <div class="container mt-5">
        <form>
            <div class="form-group">
                <label for="input1">Input 1:</label>
                <input type="text" class="form-control" id="input1">
            </div>
        </form>

        <form>
            <div class="form-group">
                <label for="input2">Input 2:</label>
                <input type="text" class="form-control" id="input2">
            </div>
        </form>

        <form>
            <div class="form-group">
                <label for="input3">Input 3:</label>
                <input type="number" class="form-control" id="input3">
            </div>
        </form>
    </div>

    <div id="keyboard-container">
        <button class="btn btn-danger float-right" id="btnClose"><i class="fa-brands fa-xbox"></i></button>
        <div id="input-name"></div>
        <input type="text" id="keyboard-input" class="form-control mb-2" autofocus>

        <div class="keyboard-row">
            <div class="keyboard-key" data-key="`">`</div>
            <div class="keyboard-key" data-key="1">1</div>
            <div class="keyboard-key" data-key="2">2</div>
            <div class="keyboard-key" data-key="3">3</div>
            <div class="keyboard-key" data-key="4">4</div>
            <div class="keyboard-key" data-key="5">5</div>
            <div class="keyboard-key" data-key="6">6</div>
            <div class="keyboard-key" data-key="7">7</div>
            <div class="keyboard-key" data-key="8">8</div>
            <div class="keyboard-key" data-key="9">9</div>
            <div class="keyboard-key" data-key="0">0</div>
            <div class="keyboard-key" data-key="_">_</div>
            <div class="keyboard-key" data-key="=">=</div>
            <div class="keyboard-key" data-key="delete"><i class="fas fa-backspace"></i></div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key" data-key="tab"><b>tab</b></div>
            <div class="keyboard-key" data-key="q">q</div>
            <div class="keyboard-key" data-key="w">w</div>
            <div class="keyboard-key" data-key="e">e</div>
            <div class="keyboard-key" data-key="r">r</div>
            <div class="keyboard-key" data-key="t">t</div>
            <div class="keyboard-key" data-key="y">y</div>
            <div class="keyboard-key" data-key="u">u</div>
            <div class="keyboard-key" data-key="i">i</div>
            <div class="keyboard-key" data-key="o">o</div>
            <div class="keyboard-key" data-key="p">p</div>
            <div class="keyboard-key" data-key="[">[</div>
            <div class="keyboard-key" data-key="]">]</div>
            <div class="keyboard-key" data-key="\">\</div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key capslock-toggle" data-key="capslock"><i class="fa-solid fa-arrow-down-up-lock"></i></div>
            <div class="keyboard-key" data-key="a">a</div>
            <div class="keyboard-key" data-key="s">s</div>
            <div class="keyboard-key" data-key="d">d</div>
            <div class="keyboard-key" data-key="f">f</div>
            <div class="keyboard-key" data-key="g">g</div>
            <div class="keyboard-key" data-key="h">h</div>
            <div class="keyboard-key" data-key="j">j</div>
            <div class="keyboard-key" data-key="k">k</div>
            <div class="keyboard-key" data-key=";">;</div>
            <div class="keyboard-key" data-key="'">'</div>
            <div class="keyboard-key" data-key="enter"><i class="fa-solid fa-arrow-right-to-bracket"></i></div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key shift-toggle" data-key="shift"><i class="fa-solid fa-arrow-up-z-a"></i></div>
            <div class="keyboard-key" data-key="?">?</div>
            <div class="keyboard-key" data-key="z">z</div>
            <div class="keyboard-key" data-key="x">x</div>
            <div class="keyboard-key" data-key="c">c</div>
            <div class="keyboard-key" data-key="v">v</div>
            <div class="keyboard-key" data-key="b">b</div>
            <div class="keyboard-key" data-key="n">n</div>
            <div class="keyboard-key" data-key="m">m</div>
            <div class="keyboard-key" data-key=",">,</div>
            <div class="keyboard-key" data-key=".">.</div>
            <div class="keyboard-key" data-key="/">/</div>
            <div class="keyboard-key shift-toggle" data-key="shift"><i class="fa-solid fa-arrow-up-z-a"></i></div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key" data-key="layout"><b>US</b> <i class="fas fa-solid fa-globe"></i></div>
            <div class="keyboard-key symbol-toggle" data-key="symbol"><b>alt</b></div>
            <div class="keyboard-key" data-key=" "></div>
            <div class="keyboard-key symbol-toggle" data-key="symbol"><b>alt</b></div>
            <div class="keyboard-key" data-key="←"><i class="fas fa-arrow-left"></i></div>
            <div>
                <div class="keyboard-key" data-key="↑"><i class="fas fa-arrow-up"></i></div>
                <div class="keyboard-key" data-key="↓"><i class="fas fa-arrow-down"></i></div>
            </div>
            <div class="keyboard-key" data-key="→"><i class="fas fa-arrow-right"></i></div>
        </div>
    </div> 
        
   <!-- <div id="keyboard-container">
        <button class="btn btn-danger float-right" id="btnClose"><i class="fa-brands fa-xbox"></i></button>
        <div id="input-name"></div>
        <input type="text" id="keyboard-input" class="form-control mb-2" autofocus>

        <div class="keyboard-row">
            <div class="keyboard-key" data-key="7">7</div>
            <div class="keyboard-key" data-key="8">8</div>
            <div class="keyboard-key" data-key="9">9</div>
            <div class="keyboard-key" data-key="-">-</div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key" data-key="4">7</div>
            <div class="keyboard-key" data-key="5">5</div>
            <div class="keyboard-key" data-key="6">6</div>
            <div class="keyboard-key" data-key="+">+</div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key" data-key="1">1</div>
            <div class="keyboard-key" data-key="2">2</div>
            <div class="keyboard-key" data-key="3">3</div>
            <div class="keyboard-key" data-key="delete"><i class="fas fa-backspace"></i></div>
        </div>
        <div class="keyboard-row">
            <div class="keyboard-key" data-key="0">0</div>
            <div class="keyboard-key" data-key="enter"><i class="fa-solid fa-arrow-right-to-bracket"></i></div>
            <div class="keyboard-key" data-key="layout"><b>US</b> <i class="fas fa-solid fa-globe"></i></div>
        </div>
    </div> -->

    <script>
        $(document).ready(function () {
            var currentInputName = "";
            var isUppercase = false;
            var isCapsLock = false;
            var shiftPressed = false;
            var isSymbolMode = false;

            var layouts = {
                normal: {
                    '`':'`','1': '1', '2': '2', '3': '3', '4': '4', '5': '5', '6': '6', '7': '7', '8': '8', '9': '9', '0': '0','_':'_','=':'=',
                    'q': 'q', 'w': 'w', 'e': 'e', 'r': 'r', 't': 't', 'y': 'y', 'u': 'u', 'i': 'i', 'o': 'o', 'p': 'p','[':'[',']':']','':'',
                    'a': 'a', 's': 's', 'd': 'd', 'f': 'f', 'g': 'g', 'h': 'h', 'j': 'j', 'k': 'k', ';': ';','': '',
                    'z': 'z', 'x': 'x', 'c': 'c', 'v': 'v', 'b': 'b', 'n': 'n', 'm': 'm',',': ',','.': '.','/': '/',     
                },
                uppercase: {
                    '`':'~','1': '!', '2': '@', '3': '#', '4': '$', '5': '%', '6': '^', '7': '&', '8': '*', '9': '(', '0': ')','_':'-','=':'+',
                    'q': 'Q', 'w': 'W', 'e': 'E', 'r': 'R', 't': 'T', 'y': 'Y', 'u': 'U', 'i': 'I', 'o': 'O', 'p': 'P','[':'{',']':'}','':'|',
                    'a': 'A', 's': 'S', 'd': 'D', 'f': 'F', 'g': 'G', 'h': 'H', 'j': 'J', 'k': 'K',';': ';','': '',
                    'z': 'Z', 'x': 'X', 'c': 'C', 'v': 'V', 'b': 'B', 'n': 'N', 'm': 'M',',': '<','.': '>','/': '?',                 
                },
                alt: {
                    'e': '€', 
                }
            };

            $('input').click(function () {
                currentInputName = $(this).attr('id');
                $('#input-name').text(currentInputName);
                $('#keyboard-container').show();
                $('#keyboard-input').val($(this).val());
                $('#keyboard-input').focus();
            });

            $('#btnClose').click(function () {
                $('#keyboard-container').hide();
            });

            $('.keyboard-key[data-key="enter"]').click(function () {
                var currentInput = $('#' + currentInputName);
                currentInput.val($('#keyboard-input').val());
                $('#keyboard-container').hide();
            });

            $('.keyboard-key').click(function () {
                var currentInput = $('#keyboard-input');
                var key = $(this).data('key');

                if (key === 'shift') {
                    isUppercase = !isUppercase;
                    shiftPressed = true;
                    updateKeyboardLayout();
                } else if (key === 'capslock') {
                    isCapsLock = !isCapsLock;
                    isUppercase = isCapsLock; // Imposta maiuscole se Caps Lock è attivo
                    updateKeyboardLayout();
                } else if (key === 'symbol') {
                    isSymbolMode = !isSymbolMode;
                    updateKeyboardLayout();
                } else if (key === 'delete') {
                    var cursorPos = currentInput.prop('selectionStart');
                    var textBefore = currentInput.val().substring(0, cursorPos - 1);
                    var textAfter = currentInput.val().substring(cursorPos);
                    currentInput.val(textBefore + textAfter);
                    currentInput.prop('selectionStart', cursorPos - 1);
                    currentInput.prop('selectionEnd', cursorPos - 1);
                } else if (key === '←') {
                    var cursorPos = currentInput.prop('selectionStart');
                    currentInput.prop('selectionStart', cursorPos - 1);
                    currentInput.prop('selectionEnd', cursorPos - 1);
                } else if (key === '→') {
                    var cursorPos = currentInput.prop('selectionStart');
                    currentInput.prop('selectionStart', cursorPos + 1);
                    currentInput.prop('selectionEnd', cursorPos + 1);
                } else if (key === '↑') {
                    $('#' + currentInputName).prev('form').find('input').focus();
                } else if (key === '↓') {
                    $('#' + currentInputName).next('form').find('input').focus();
                } else if (key === ' ') {
                    var cursorPos = currentInput.prop('selectionStart');
                    var textBefore = currentInput.val().substring(0, cursorPos);
                    var textAfter = currentInput.val().substring(cursorPos);
                    currentInput.val(textBefore + ' ' + textAfter);
                    currentInput.prop('selectionStart', cursorPos + 1);
                    currentInput.prop('selectionEnd', cursorPos + 1);
                } else {
                    var cursorPos = currentInput.prop('selectionStart');
                    var textBefore = currentInput.val().substring(0, cursorPos);
                    var textAfter = currentInput.val().substring(cursorPos);
                    currentInput.val(textBefore + layouts[getCurrentLayout()][key] + textAfter);
                    currentInput.prop('selectionStart', cursorPos + 1);
                    currentInput.prop('selectionEnd', cursorPos + 1);

                    if (shiftPressed) {
                        isUppercase = false;
                        shiftPressed = false;
                        updateKeyboardLayout();
                    }
                }
                // Mantieni il focus sull'input anche durante la digitazione
                currentInput.focus();
            });

            function getCurrentLayout() {
                if (isSymbolMode) {
                    return 'alt';
                } else if (isUppercase || isCapsLock) {
                    return 'uppercase';
                } else {
                    return 'normal';
                }
            }

            function updateKeyboardLayout() {
                var keys = $('.keyboard-key[data-key]');
                keys.each(function () {
                    var key = $(this).data('key');
                    $(this).text(layouts[getCurrentLayout()][key]);
                });

                updateCapsLock();
                updateShift();
                updateSymbolToggle();
            }

            function updateCapsLock() {
                var capsLockToggle = $('.keyboard-key[data-key="capslock"]');
                capsLockToggle.toggleClass('active', isCapsLock);
            }

            function updateShift() {
                var shiftToggle = $('.keyboard-key[data-key="shift"]');
                shiftToggle.toggleClass('active', shiftPressed);
            }

            function updateSymbolToggle() {
                var symbolToggle = $('.keyboard-key[data-key="symbol"]');
                symbolToggle.toggleClass('active', isSymbolMode);
            }

            $(document).on('keydown', function (event) {
                if (event.key === 'Enter') {
                    var currentInput = $('#' + currentInputName);
                    currentInput.val($('#keyboard-input').val());
                    $('#keyboard-container').hide();
                }
            });

            $('#keyboard-input').on('input', function () {
                // Mantieni il focus sull'input anche durante la digitazione
                $(this).focus();
            });

        });
    </script>

</body>

</html>
